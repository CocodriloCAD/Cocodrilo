## Current state of the development of a MPM-Preprocessor using Cocodrilo

Dec '22

The transient analysis of a cantilever beam under dead load has been validated with the .json and .mdpa files which can be found in the directories files_GID and files_Cocodrilo. The results for the Kratos input files from Cocodrilo are the same as the results for the files from GID. This can be seen in detail in the excel-file "Validation_results".

Jan '22

The static analysis of the cantilever example, which has been used for the validation of the transient analysis, was also validated. The details can be found in the excel-file "Validation_results". The respective GID-files can be generated by changing the analysis type in GID to "static" and writing the calculation files subsequently.



For more complex geometries, boundary conditions and other analyses no validation was conducted so far. Therefore, errors are likely to occur. 

# Documentation: How to use Rhino/Grasshopper & Cocodrilo to generate simulation files for the KRATOS Multiphysics MPM Application

## Linear Analysis
This tutorial explains how to generate the computation files of a linear static analysis with the [KRATOS Multiphysics](https://github.com/KratosMultiphysics/Kratos/wiki) [Particle Mechanics Application](https://github.com/KratosMultiphysics/Kratos/tree/master/applications/ParticleMechanicsApplication) and [Cocodrilo](https://github.com/CocodriloCAD/Cocodrilo), a plugin for Grasshopper/ Rhino. For that purpose a plate element (see Figure 1), clamped at one side, is modeled and analyzed with the material point method. 

<p align="center" width="100%">
    <img width="50%" src="https://user-images.githubusercontent.com/51473791/221582986-856d6c0f-cadf-46e5-9573-78aa4f81ea42.png">
    <br>
    <em>Figure 1: clamped plate that is analyzed in this tutorial.</em>
</p>

Table of contents:

1) [General User Interface](https://github.com/CocodriloCAD/Cocodrilo/blob/MPM_GH/validatation/Readme.md#1-general-user-interface)
2) [Define analysis](https://github.com/CocodriloCAD/Cocodrilo/blob/MPM_GH/validatation/Readme.md#2-define-analysis-method)
3) Generate Body 
3.1) Set up body geometry 
3.1) Define boundary conditions
5) Choose material
6) Define mesh
7) Generate calcualtion files
8) Remove errors
9) Limitations of the current software version

#### 1) General User Interface

The graphical user interface of Cocodrilo/Grasshopper/Rhino is depicted in Figure 2: 

<p align="center" width="100%">
    <img width="75%" src="https://user-images.githubusercontent.com/51473791/221424826-ef5c6955-fe54-47cc-8d4e-202bc5510391.png">
    <br>
    <em>Figure 2: graphical user interface of Grasshopper; the tab of Cocodrilo is marked with the red rectangle.</em>
</p>

To see the menues *Analyses, DEM, Elements, Geometry, Materials, Models* and *Postprocessing* of Cocodrilo, click on the *Cocodrilo*-tab, as indicated by the red rectangle in Figure 2.

### 2) Define analysis method
To create a new model, set up a new, empty canvas in Grasshopper. For a MPM analysis, add the *Material point method* analysis field from the *Analyses*-menu (see Figure 3) to the canvas by clicking first on *MPM*, and then on the canvas.

<p align="center" width="100%">
    <img width="75%" src="https://user-images.githubusercontent.com/51473791/221430285-af621478-7425-4302-b9d2-bc8d66afc1a1.png">
    <br>
    <em>Figure 3: icon of the the MPM analysis field in the "Analyses" menu.</em>
</p>

<p align="center" width="100%">
    <img width="75%" src="https://user-images.githubusercontent.com/51473791/221428914-228ebd5c-2b22-419c-a88d-2e94d2b1bd7d.png">
    <br>
    <em>Figure 4: MPM analysis field on the canvas of Grasshopper.</em>
</p>

For a linear, static analysis (LSA) of the cantilever, add a linear static analysis field in a next step from the *Analyses* menu (see Figure 5) to 
the current canvas (see Figure 6).

<p align="center" width="100%">
    <img width="75%" src="https://user-images.githubusercontent.com/51473791/221426370-610b969b-788d-434d-891a-4ffafd053a62.png">
    <br>
    <em>Figure 5: linear analysis icon in the "Analyses" menu.</em>
</p>

<p align="center" width="100%">
    <img width="75%" src="https://user-images.githubusercontent.com/51473791/221427289-a2cd1b8e-8a22-4c9d-84c0-429a7c10ca04.png">
    <br>
    <em>Figure 6: linear analysis field added to the current canvas.</em>
</p>

When both fields (*MPM Analysis and LSA*) are present, connect them by drawing a line from "analysis" of the LSA field to "Analysis type" of the MPM analysis field, as shown in Figure 7.
Now the desired analysis fields are present on the canvas. In the next step we will add the geometry.

<p align="center" width="100%">
    <img width="75%" src="https://user-images.githubusercontent.com/51473791/221429003-4f8f0e8d-05ca-4b31-a62c-9a47a5aef40e.png">
    <br>
    <em>Figure 7: the LSA and MPM analysis field are connected by a line.</em>
</p>



### 3) Geometry
The basis for setting up the geometry is the *Geo*-node within the *MPM*-field. Due to the internal data structure of *Cocodrilo*, a lot of information of the modelled problem is entered via the *Geo*-node. For example, later we will see that the input data from material parameters, boundary conditions and the body-mesh are entered via the *Geo*-node.

#### Cantilever beam
In order to model the cantilever beam which is depicted below, we have to add a *solid*-element. However, this element is not an element in the sense of a finite-element, e.g. a plate element with 2 dofs at each corner, but rather an object in the sense of object-oriented-programming which has the mesh, the material and the thickness of the structure which shall be modelled as member variables. 

![grafik](https://user-images.githubusercontent.com/51473791/221550075-c992e18d-27a5-4cc2-a193-49205816d817.png)

After adding the *solid*-element, a *MPM-Material*- as well as a *MPlane*-field have to be added. 

![grafik](https://user-images.githubusercontent.com/51473791/221549704-cd9d943b-44da-43e6-b77b-a39d0ffac3ec.png)

For the *MPlane*(=mesh plane)-field click on the section "Mesh":

![grafik](https://user-images.githubusercontent.com/51473791/221550515-558ef1c6-e860-4be5-91f5-12007b9b39e5.png)

Add all these fields to the plane and connect them as shown in the picture below:

![grafik](https://user-images.githubusercontent.com/51473791/221551013-b48299e0-be5e-426a-bee3-9904fefad170.png)

To set the width and length of the beam, right click the *B*-node of the *MPlane* field. Then the subsequent depicted menu opens:

![grafik](https://user-images.githubusercontent.com/51473791/221567498-e5cfb713-e7a0-46c1-825f-73c8a330cae0.png)

Choose "Set one rectangle", as indicated by the red rectangle. Subsequently, the GUI of Rhino will appear where the dimensions of the cantilever beam can be entered.

![grafik](https://user-images.githubusercontent.com/51473791/221569196-23fdf884-f1d1-4a2e-9b56-940ca21382d2.png)

Add in the line which is indicated by the red rectangle the coordinates for the cantilever beam in the following way:
- Point 1: 0.0,0.5 
- Point 2: 1.5,0.5
- Point 3: 1.5,1.5

Finally, confirm the coordinates by hitting "enter" and the Grasshopper-canvas will appear again. If you click once a again on "Set one rectangle", you should see the following rectangle in Rhino:

![grafik](https://user-images.githubusercontent.com/51473791/221571181-b220da8a-a3d4-40dc-adf2-01e86d39a26c.png)

### 4) Meshing of the cantilever
In this example we want to mesh the cantilever with a quadrilateral mesh. The edge lenghts of the elements should be 0.1m. For that purpose, right click *w* (=Width Count: Number of faces along x-direction) and "Set integer". Here, enter 15, as we have a cantilever with a length of 1.5m and with 15 elements in the x-direction, each element has length of 0.1m in the x-direction.
Subsequently, set analogously *h* (=Height Count: Number of faces in y-direction) to 10.


### 5) Material 
The material parameters for the steel plate can be entered in the *MPM Material* field. The default parameters of *MPM Material* are the ones from steel.
XXX Bild anpassenXXX

The material nodes correspond to the following parameters:
- N: Name, e.g. Steel
- CL: Constitutive Law, e.g. LinearElasticIsotropicPlaneStrain2DLaw
- rho: Density
- E: Young's Modulous 
- nue: Poisson ratio
- c: Cohesion
- phi: Internal friction angle
- psi: Internal dilatancy angle
- n: Number of particles per element
- t: thickness of the element XXX Check which thickness is considered internallyXX!


As the default parameters are the parameters of the clamped plate of the example, only n, the number of particles per element, must be adapted. The default value of n is 3, but here a quadrilateral mesh is used. Therefore, the number of particles per element can be increased to 4.

### 6) Background domain
Although we haven't added any boundary conditions for the body domain yet, we will proceed with the background domain. The boundary conditions of the problem will be added in the last step, as they are imposed on the background mesh. For that purpose, of course, a background mesh has to be created beforehand. Therefore, we will continue with the background domain now. We start by adding a *FEM* model to the canvas (see fig. XX). You can find it in the **Models** section of *Cocodrilo*. Moreover, add as previiously shown, a mesh plane (*MPlane*) field to mesh the background domain to the canvas. Connect the *MPM*, *FEM* and *MPlane* fields as shown below in fig. XX.

<p align="center" width="100%">
    <img width="80%" src="https://user-images.githubusercontent.com/51473791/224546430-0432ddc0-15a1-4938-b733-99691c7a07ef.jpg">
    <br>
    <em>Figure XX: FEM-model and MPlane for background domain are present on canvas.</em>
</p>

To create a background domain and a background mesh, we proceed analogously as in section (Link to mesh generation). Firstly, we right click on the *MPlane* field and click afterwards *Set on rectangle* in the appearing menu. Then the GUI of Rhino should appear. Here we enter, as done previously, the coordinates of the rectangle that will be the background domain. Now we enter:

- Point 1: 0.0,0.0 
- Point 2: 2.0,0.0
- Point 3: 2.0,2.0

After entering the three points and confirming with "enter", the Rhino GUI will close again. If you reopen it (by clicking again on set on rectangle), the created rectangles should look the following way in the topview:

<p align="center" width="100%">
    <img width="50%" src="https://user-images.githubusercontent.com/51473791/224571659-2ede6755-fa40-40b0-b6f1-aa4ba4c5ad4d.jpg">
    <br>
    <em>Figure XX: Support Icon in Cocodrilo-menu</em>

</p>

To obtain a quadrilateral mesh with elements with an edge length of 0.2m, we have to set *W* (number of faces along x-direction) and *H* (number of faces along y-direction) to 10. Now we set up a background mesh.


### 8) Boundary Conditions 
To add a boundary condition on the background grid, click on the support icon as shown in the picture below:

<p align="center" width="100%">
    <img width="50%" src="https://user-images.githubusercontent.com/51473791/224542007-1cfc054b-8490-45e1-953e-381f70252fe9.jpg">
    <br>
    <em>Figure XX: Support Icon in Cocodrilo-menu</em>
</p>

Subsequently, add a support- and a curve-field to the canvas. A curve may be added the following way: double click on a free space on the canvas and wrtie in the appearing line *crv*. Then a curve-field as shown in fig. XX should appear.

<p align="center" width="100%">
    <img width="50%" src="https://user-images.githubusercontent.com/51473791/224545525-d6409ca4-e05c-4c5c-b4b8-62607ccba771.jpg">
    <br>
    <em>Figure XX: Grasshopper set up for body inlcuding a field for support and curve</em>
</p>

The orange color of the curve field indicates that it is lacking input data. To add input data, right click *curve* and choose *Set one curve*. Ensuilingly, the *Rhino* GUI appears and the a 



